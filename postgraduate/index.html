<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta name="format-detection" content="telephone=no">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="Description" content="新东方在线考研">
	<meta name="Keywords" content="新东方在线考研">
	<link rel="stylesheet" type="text/css" href="css/invite.css?v0.2" />
	<title>新东方在线考研</title>
</head>
<body>
    <div class="wrap" id="scene">
        <h1>新东方在线考研</h1>
        <div class="sec">
            <div class="bg">
                <div class="bg_sec bg01"></div>
                <div class="bg_sec bg02">
                </div>
                <div class="bg_sec bg03">
                </div>
                <div class="bg_sec bg04">
                </div>
                <div class="bg_sec bg05">
                </div>
                <div class="bg_sec bg06"></div>
                <div class="bg_sec bg07"></div>
                <div class="bg_sec bg08"></div>
                <div class="bg_sec bg09"></div>
                <div class="bg_sec bg10"></div>
                <div class="bg_sec bg11"></div>
                <div class="bg_sec bg12"></div>
            </div>
            <section class="sec01" style="display:;">
                <h2 class="title title-1"></h2>
                <div class="title title-2"></div>
                <div class="layer" data-depth="0.75">
                    <span class="map"></span>
                    <span class="target"></span>
                </div>
                <div class="layer" data-depth="1.2">
                    <span class="ico_tri04"></span><span class="ico_tri05"></span><span class="ico_tri06"></span>
                </div>
                <span class="start"><b><img src="img/arrow.png" /></b><em class="start-tips">向上滑动</em></span>
            </section>
            <section class="sec02 " style="display:;">
            	<div class="clock"></div>
            	<div class="formula"></div>
            	<div class="bed"></div>
            	<div class="profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec03 " style="display:;">
            	<div class="layer" data-depth="0.75">
            		<div class="plane plane-1"></div>
            		<div class="plane plane-2"></div>
            	</div>
            	<div class="children"></div>
            	<div class="monther"></div>
            	<div class="profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec04 " style="display:;">
            	<div class="picbg ill"></div>
            	<div class="picbg light"></div>
            	<div class="picbg profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec05 " style="display:;">
                <div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
                 <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            
            <section class="sec06 " style="display:;">
                <div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
            	<div class="picbg rocket"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec07 " style="display:;">
                <div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            
            <section class="sec08 " style="display:;">
            	<div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            
            <section class="sec09 " style="display:;">
            	<div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
            	<div class="picbg book"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            
            <section class="sec10" style="display:;">
            	<div class="picbg ill"></div>
            	<div class="picbg title"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec11" style="display:;">
            	<div class="picbg ill"></div>
            	<div class="picbg title"></div>
            	<div class="picbg profile"></div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            <section class="sec12" style="display:;">
            	<div class="picbg ill">
            		<img src="img/sec12_02.png" class="weixin" />
            		<a class="btn-follow" href="http://mp.weixin.qq.com/s?__biz=MjM5OTAzMjc4MA==&mid=201654180&idx=2&sn=46e242ddcda243b17be1cbf63f5f9955&scene=1&key=f22fd2fbab4acbb7309d83b9bccd6a230f02d70fd4b43ce0ce3fdfe4c7b143aa605a3e67a209bf16596dff258ee65bee&ascene=1&uin=MTEzMDAwOTE0MA%3D%3D&devicetype=webwx&version=70000001&pass_ticket=S35KYoQTbof7T0Yuh2S9Ky9ralY4nBHciPFOQKYXAB%2FrhQ8wc9K0KxR0UL13YvYD"></a>
            		<a id="js-share-button" class="btn-share"></a>
            	</div>
                <span class="start"><b><img src="img/arrow.png" /></b></span>
            </section>
            
    </div>
    <div id="shareMask" class="share-mask">
	</div>
	<div class="music">
		<audio src="img/bgmusic.mp3" autoplay="autoplay" preload="metadata" loop="loop" id="bgMusic"></audio>
	</div>
	<div id="musicPlay" class="music-ico music-ico-on"></div>
    </div>
</body>
<script src="http://up.qq.com/2014/invitation/parallax.js"></script>
<script src="js/zepto.min.js"></script>
<script>
function IsPC()  
{  
           var userAgentInfo = navigator.userAgent;  
           var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");  
           var flag = true;  
           for (var v = 0; v < Agents.length; v++) {  
               if (userAgentInfo.indexOf(Agents[v]) > 0) { flag = false; break; }  
           }  
           return flag;  
}

var jumpPc = IsPC();
if(jumpPc!=false){
//window.location.href = "http://up.qq.com";
}

document.body.addEventListener('touchstart', function (e) {
    //console.log("target:"+e.target.className);
    e = e.changedTouches[0];
    onStart(e);
});

document.body.addEventListener('touchmove', function (e) {
    onMove(e.changedTouches[0], e);
});

document.body.addEventListener('touchend', function (e) {
    onEnd(e.changedTouches[0]);
});

// 翻转的绑定
window.onorientationchange = orientationChange;

function initPage(){
	pageWidth = $(window).width();
	pageHeight = $(".wrap").height();
	pages = $(".wrap section");
	$(".bg .bg_sec").css("height",pageHeight);
    var bg_sec_height = $('.bg .bg_sec').height();

    $(".wrap section").css({
        "width":pageWidth+"px",//"height":$(".wrap").height()+"px"
        "height":pageHeight+"px"
    });
    //$(".wrap").height($(".wrap").height());

    secHeight = pageHeight * $(".wrap section").length;
    lineHeight = 832 * secHeight / pageHeight;

    $(".sec, .line").addClass("drag");
    animatePage(curPage);
    //$(".sec, .line").removeClass("drag");

}

function orientationChange(){
	initPage();
}

// 以下是拖动效果
var startX = 0,
    startY = 0;
    margin = 0;
var pages = null;
var curPage = 0;
var pageWidth = 0,
    pageHeight = 0;
var lineHeight = 0, secHeight = 0;
var targetElement = null;
var scrollPrevent = false, movePrevent = false, touchDown = false;

$(document).ready(function(){
	initPage();
});

function onStart (e) {
    if(movePrevent == true){
        event.preventDefault();
        return false;
    }
    if($(e.target).parents("#container").length==1){
        scrollPrevent = true;
    }else{
        scrollPrevent = false;
    }

    $(".map").on('click', function(e){
    	$(".map_show").addClass("show");
    })

    if(!$(e.target).parents("#container").length==1){
	    $(".map_show").removeClass("show");
    }

    touchDown = true;

    // 起始点，页面位置
    startX = e.pageX;
    startY = e.pageY;
    //margin = parseInt($(".sec").css("top"));
    //-webkit-transform:translateY(0px)

    //matrix(1, 0, 0, 1, 0, 8)

    $(".sec, .line").addClass("drag");

    margin = $(".sec").css("-webkit-transform");
    //margin = "matrix(1, 0, 0, 1, 0, -50)";
    margin = margin.replace("matrix(", "");
    margin = margin.replace(")", "");
    margin = margin.split(",");
    margin = parseInt(margin[5]);
}

function onMove (e, oe) {
    if(movePrevent == true || touchDown != true){
        event.preventDefault();
        return false;
    }
    event.preventDefault();
    if( scrollPrevent==false && e.pageY!=startY){
        var temp = margin + e.pageY - startY;
        $(".sec").css("-webkit-transform", "matrix(1, 0, 0, 1, 0, "+temp+")");
        var b =  lineHeight / secHeight * temp;
        $(".line").css("-webkit-transform", "matrix(1, 0, 0, 1, 0, "+b+")");
    }
}

function onEnd (e) {
    if(movePrevent == true){
        event.preventDefault();
        return false;
    }

    touchDown = false;

    if( scrollPrevent==false ){
        // 抬起点，页面位置
        endX = e.pageX;
        endY = e.pageY;
        // swip 事件默认大于50px才会触发，小于这个就将页面归回
        if( Math.abs(endY-startY)<=50) {
            animatePage(curPage);
        }else{
        	if(endY>startY){
        		prevPage();
        	}else{
        		nextPage();
        	}
        }
    }

    $(".sec, .line").removeClass("drag");
}

function prevPage(){
    var newPage = curPage - 1;
    animatePage(newPage);
    
}
function nextPage(){
    var newPage = curPage + 1;
    animatePage(newPage);
}

function animatePage( newPage ){
    if(newPage<0){
        newPage = 0;
    }
    if(newPage>$(".wrap section").length-1){
        newPage = $(".wrap section").length-1;
    }

    curPage = newPage;
    var newMarginTop = newPage * (-pageHeight);
    $(".sec").css({
        "-webkit-transform" : "matrix(1, 0, 0, 1, 0, "+newMarginTop+")"
    });

    var newTop = -parseInt(curPage*pageHeight*(lineHeight/secHeight));
    $(".line").css({
        "-webkit-transform" : "matrix(1, 0, 0, 1, 0, "+newTop+")"
    });

    movePrevent = true;
    setTimeout("movePrevent=false;", 300 );

    // 每页动画
    if( !$(pages[curPage]).hasClass("sec0" + (curPage+1) + "_show") ){
        $(pages[curPage]).addClass("sec0" + (curPage+1) + "_show");
    }
    $(pages[curPage-1]).removeClass("sec0" + (curPage) + "_show");
    $(pages[curPage+1]).removeClass("sec0" + (curPage+2) + "_show");

}


// 视差
var scene = document.getElementById('scene');
var parallax = new Parallax(scene);
function onBridgeReady() {
    var mainTitle="当考验还剩50天..新东方在线",
        mainDesc="新东方在线考研服务为您加油 转发抽奖+考上心仪大学",
        mainURL="http://dev.hotkeypower.com/lfhtml/graduate/index.html?v0.2",
        mainImgUrl= "http://dev.hotkeypower.com/lfhtml/graduate/img/wx_thumb.jpg";

    //转发朋友圈
    WeixinJSBridge.on("menu:share:timeline", function(e) {
        var data = {
            img_url:mainImgUrl,
            img_width: "120",
            img_height: "120",
            link: mainURL,
            //desc这个属性要加上，虽然不会显示，但是不加暂时会导致无法转发至朋友圈，
            desc: mainDesc,
            title: mainTitle
        };
        WeixinJSBridge.invoke("shareTimeline", data, function(res) {
            WeixinJSBridge.log(res.err_msg)
        });
    });
    //同步到微博
    WeixinJSBridge.on("menu:share:weibo", function() {
        WeixinJSBridge.invoke("shareWeibo", {
            "content": mainDesc,
            "url": mainURL
        }, function(res) {
            WeixinJSBridge.log(res.err_msg);
        });
    });
    //分享给朋友
    WeixinJSBridge.on('menu:share:appmessage', function(argv) {
        WeixinJSBridge.invoke("sendAppMessage", {
            img_url: mainImgUrl,
            img_width: "120",
            img_height: "120",
            link: mainURL,
            desc: mainDesc,
            title: mainTitle
        }, function(res) {
            WeixinJSBridge.log(res.err_msg)
        });
    });
};
//执行
$("#musicPlay").on("click", function(){
	var bgMusic = document.getElementById("bgMusic");
	if($(this).hasClass("music-ico-on")) {
		bgMusic.pause();
		$(this).removeClass("music-ico-on");		
	} else {
		$(this).addClass("music-ico-on");		
		bgMusic.play();
	}
});
var $shareBtn = $("#js-share-button")
,	$shareMask = $("#shareMask")
;
$shareBtn.on("touchstart", function(){
	$shareMask.show();	
});
$shareMask.on("touchstart", function(){
	$shareMask.hide();
});
document.addEventListener('WeixinJSBridgeReady', function() {
    onBridgeReady();
});
$(function(){
	$("#scene").css({"visibility":"visible"});
});
</script>
</html>